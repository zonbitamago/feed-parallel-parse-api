# Feature Specification: 購読フィード一覧の折りたたみ機能

**Feature Branch**: `010-improve-feed-article-access`
**Created**: 2025-10-30
**Status**: Draft
**Input**: User description: "購読フィードが増えると記事のリンクに一見でたどり着けないので改善したい"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 購読一覧を折りたたんで記事を優先表示 (Priority: P1)

RSSリーダーの最も重要な目的は記事を読むことです。しかし、購読フィード数が増えると、画面上部の購読フィード一覧が縦に長くなり、ファーストビューから記事一覧が押し出されてしまいます。ユーザーは、購読管理を必要としない通常時には、記事一覧を最優先で表示したいと考えています。

**Why this priority**: これはRSSリーダーとしての根本的な問題です。記事を読むために訪れたユーザーが、スクロールしないと記事が見えないのは致命的なUX問題です。購読フィードが10件を超えると、記事へのアクセスに複数回のスクロールが必要となり、本来の目的が阻害されます。

**Independent Test**: ページ読み込み時に購読一覧が折りたたまれており、記事一覧がファーストビューに表示されることを確認するだけで、この機能単独でテスト可能です。MVPとして十分な価値を提供します。

**Acceptance Scenarios**:

1. **Given** 20件のフィードを購読している、**When** ページを開く、**Then** 購読一覧は折りたたまれた状態（最小化）で表示され、記事一覧がファーストビューに表示される
2. **Given** 購読一覧が折りたたまれている、**When** 「購読フィードを表示」ボタンをクリック、**Then** 購読一覧が展開され、全フィードが表示される
3. **Given** 購読一覧が展開されている、**When** 「購読フィードを隠す」ボタンをクリック、**Then** 購読一覧が再び折りたたまれ、記事一覧が見やすくなる

---

### User Story 2 - 折りたたみ状態の永続化 (Priority: P2)

ユーザーが購読管理を頻繁に行う場合、毎回購読一覧を展開するのは手間です。ユーザーの好みの表示状態（折りたたみ/展開）を記憶し、次回訪問時にも同じ状態で表示することで、個々のユーザーの利用スタイルに合わせた体験を提供できます。

**Why this priority**: P1の折りたたみ機能があれば基本的な問題は解決しますが、ユーザーの利用スタイルは様々です。購読管理を頻繁に行うユーザーにとって、毎回展開するのは不便です。この機能により、両方のユーザータイプに最適化された体験を提供できます。

**Independent Test**: 折りたたみ状態を変更し、ページをリロードして同じ状態が維持されることを確認することで、単独でテスト可能です。

**Acceptance Scenarios**:

1. **Given** 購読一覧を折りたたんだ状態、**When** ページをリロード、**Then** 購読一覧は折りたたまれた状態のままである
2. **Given** 購読一覧を展開した状態、**When** ページをリロード、**Then** 購読一覧は展開された状態のままである
3. **Given** 初回訪問のユーザー、**When** ページを開く、**Then** 購読一覧はデフォルトで折りたたまれている

---

### User Story 3 - 購読件数の視覚的表示 (Priority: P3)

購読一覧が折りたたまれている状態でも、ユーザーは現在何件のフィードを購読しているかを把握したいと考えています。折りたたみボタンまたはヘッダーに購読件数を表示することで、状況認識を維持できます。

**Why this priority**: ユーザー体験を向上させる補助的な機能です。P1とP2があれば基本的な機能は完結していますが、購読件数の表示により、ユーザーは折りたたまれた状態でも情報を失わず、安心して利用できます。

**Independent Test**: 購読一覧が折りたたまれている状態で、購読件数が表示されることを確認するだけで、単独でテスト可能です。

**Acceptance Scenarios**:

1. **Given** 15件のフィードを購読しており、購読一覧が折りたたまれている、**When** 購読管理エリアを確認、**Then** 「購読中: 15件」のような表示がされる
2. **Given** 購読一覧が折りたたまれている、**When** 新しいフィードを1件追加、**Then** 購読件数の表示が「16件」に更新される
3. **Given** 購読一覧が展開されている、**When** 購読件数の表示を確認、**Then** 展開時にも購読件数が表示される（「購読中: 15件」など）

---

### Edge Cases

- 購読フィードが0件の場合、折りたたみ機能は表示されるか?（表示されない、または無効化）
- 購読フィードが1-3件程度の少数の場合、デフォルトで折りたたむべきか?（閾値の設定: 例えば5件以上で折りたたみ）
- 折りたたみ状態を変更した直後に新しいフィードを追加した場合、展開されるか?（状態を維持）
- モバイル画面とデスクトップ画面で折りたたみの挙動は同じか?（画面サイズによって異なる可能性）
- 購読一覧が展開されている状態で記事を読んでいる際、自動で折りたたむべきか?（手動のみ）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは購読フィード一覧の表示/非表示を切り替えるトグルボタンを提供しなければならない
- **FR-002**: ページ読み込み時、購読一覧はデフォルトで折りたたまれた状態でなければならない
- **FR-003**: 折りたたまれた状態では、購読一覧の詳細（各フィードの表示）は非表示となり、フィード追加フォームと購読件数のみが表示されなければならない
- **FR-004**: ユーザーが折りたたみ状態を変更した場合、その状態をローカルストレージに保存しなければならない
- **FR-005**: ページリロード時、ユーザーが最後に設定した折りたたみ状態を復元しなければならない
- **FR-006**: 折りたたまれた状態でも、現在の購読件数が視覚的に表示されなければならない
- **FR-007**: トグルボタンには現在の状態が明確に示されなければならない（「表示」/「隠す」、または矢印アイコンなど）
- **FR-008**: 折りたたみ/展開のアニメーションはスムーズでなければならない（ユーザー体験の向上）
- **FR-009**: 購読フィード数に関わらず、すべてのユーザーに対してデフォルトで折りたたみ状態を適用しなければならない（一貫性のある動作）

### Key Entities

- **Subscription List Visibility State**: 購読一覧の表示状態
  - 折りたたみ/展開フラグ（boolean）
  - ローカルストレージに永続化
  - デフォルト値: 折りたたみ（false/collapsed）

- **Subscription Count**: 購読件数
  - 既存のsubscriptions配列の長さから計算
  - 折りたたみ状態でも常に表示

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ページ読み込み時、記事一覧の最初の記事がファーストビューに表示される（購読数が10件以上の場合でも）
- **SC-002**: 折りたたみ/展開の切り替えが1秒以内に完了する
- **SC-003**: ユーザーが折りたたみ機能により、記事へのアクセス時間が平均60%短縮される（スクロール回数の削減）
- **SC-004**: 折りたたみ機能の使い方を説明なしで90%以上のユーザーが理解できる（直感的なUI設計）
- **SC-005**: 購読数が20件以上のユーザーにおいて、記事閲覧開始までのクリック数が平均2回以下になる
