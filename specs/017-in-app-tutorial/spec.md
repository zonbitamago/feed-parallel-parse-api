# Feature Specification: アプリ内インタラクティブチュートリアル

**Feature Branch**: `017-in-app-tutorial`
**Created**: 2025-11-04
**Status**: Draft
**Input**: User description: "アプリ内でポップアップなどで使い方を説明するインタラクティブチュートリアル機能を実装する。driver.js (5kb, MIT License, React 19互換) を使用して、7ステップのステップバイステップガイドを作成。初回訪問時（フィード0件時）に自動表示し、ヘッダーのヘルプボタンからいつでも再表示可能。localStorageで表示状態を管理。TailwindCSSでカスタムスタイリング、レスポンシブ対応、アクセシビリティ対応（ARIA属性、キーボード操作）を含む。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 初回訪問時の自動チュートリアル表示 (Priority: P1)

新規ユーザーがアプリを初めて訪問したとき、購読フィードが0件の状態で自動的にインタラクティブなチュートリアルが開始される。チュートリアルは7つのステップで構成され、各ステップで画面上の対応する要素がハイライトされ、ポップアップで使い方が説明される。ユーザーは「次へ」ボタンで順次進むか、「スキップ」ボタンでいつでも中断できる。

**Why this priority**: 新規ユーザーのオンボーディング体験を向上させる最も重要な機能。アプリの使い方を理解してもらうことで、ユーザーリテンションが向上する。この機能単独でも価値を提供できる。

**Independent Test**: 新規ブラウザでアプリを開くと、自動的にチュートリアルが開始され、7ステップすべてを完了またはスキップできることを確認。チュートリアル完了後は再度自動表示されないことを確認。

**Acceptance Scenarios**:

1. **Given** ユーザーが初めてアプリを訪問し、購読フィードが0件の状態、**When** ページが読み込まれる、**Then** チュートリアルが自動的に開始され、最初のステップ（フィードURL入力欄）がハイライトされ、説明ポップアップが表示される
2. **Given** チュートリアルが表示されている、**When** ユーザーが「次へ」ボタンをクリック、**Then** 次のステップに進み、対応する要素がハイライトされ、新しい説明が表示される
3. **Given** チュートリアルの任意のステップが表示されている、**When** ユーザーが「スキップ」ボタンをクリック、**Then** チュートリアルが終了し、通常の画面に戻る
4. **Given** チュートリアルを完了またはスキップした、**When** ページをリロードする、**Then** チュートリアルは自動表示されない
5. **Given** チュートリアルが表示されている、**When** ユーザーがEscapeキーを押す、**Then** チュートリアルが終了する

---

### User Story 2 - ヘルプボタンからのチュートリアル再表示 (Priority: P2)

既存ユーザーがアプリの使い方を再確認したい場合、ヘッダーに配置されたヘルプボタンをクリックすることで、いつでもチュートリアルを再開できる。チュートリアルの内容と動作は初回表示時と同じで、ユーザーは自分のペースで進められる。

**Why this priority**: 既存ユーザーのサポートコスト削減と、新機能追加時のユーザー教育に有効。P1の自動表示機能があれば最小限のMVPは実現できるが、ユーザビリティ向上のために重要。

**Independent Test**: アプリのヘッダーに表示されたヘルプボタン（アイコン付き）をクリックすると、チュートリアルが開始され、P1と同じフローで操作できることを確認。

**Acceptance Scenarios**:

1. **Given** ユーザーがアプリを使用中（初回訪問ではない）、**When** ヘッダーのヘルプボタンをクリック、**Then** チュートリアルが最初のステップから開始される
2. **Given** チュートリアルをヘルプボタンから開始した、**When** 最後のステップまで完了、**Then** チュートリアルが終了し、通常の画面に戻る
3. **Given** ヘルプボタンが表示されている、**When** マウスホバーまたはフォーカス、**Then** ツールチップで「ヘルプ」または「チュートリアルを表示」と表示される

---

### User Story 3 - レスポンシブ対応とモバイル最適化 (Priority: P3)

チュートリアルはデスクトップ、タブレット、スマートフォンのすべてのデバイスで適切に表示される。小さい画面ではポップアップの位置が自動調整され、タッチ操作でも快適に利用できる。

**Why this priority**: PWAとしてモバイルデバイスでも使用されるため重要だが、デスクトップでの基本機能が動作すれば段階的に実装可能。

**Independent Test**: 異なる画面サイズ（320px、768px、1024px、1920px）でチュートリアルを表示し、すべてのステップでポップアップが画面内に収まり、操作可能であることを確認。

**Acceptance Scenarios**:

1. **Given** スマートフォン（幅320px）でアプリを開く、**When** チュートリアルが表示される、**Then** ポップアップが画面内に収まり、テキストが読みやすく、ボタンがタッチ操作可能なサイズで表示される
2. **Given** タブレット（幅768px）でチュートリアルを使用、**When** デバイスを縦向きから横向きに回転、**Then** ポップアップの位置が自動調整され、ハイライトが正しく表示される
3. **Given** デスクトップ（幅1920px）でチュートリアルを使用、**When** 各ステップを表示、**Then** ポップアップが対応する要素の近くに適切な位置（上下左右）で表示される

---

### User Story 4 - アクセシビリティ対応 (Priority: P3)

チュートリアルはスクリーンリーダーユーザーやキーボード操作のみのユーザーでも利用できる。適切なARIA属性が設定され、キーボードで全機能を操作でき、フォーカス管理が適切に行われる。

**Why this priority**: インクルーシブデザインとして重要だが、基本機能が動作すれば段階的に実装可能。法的要件（アクセシビリティ法規制）への対応としても必要。

**Independent Test**: キーボードのみ（マウス不使用）でチュートリアルを完了でき、スクリーンリーダー（NVDA、JAWS等）で各ステップの説明が正しく読み上げられることを確認。

**Acceptance Scenarios**:

1. **Given** チュートリアルが表示されている、**When** Tabキーを押す、**Then** フォーカスが「次へ」「スキップ」ボタンに順次移動し、視覚的なフォーカスインジケーターが表示される
2. **Given** 「次へ」ボタンにフォーカスがある、**When** Enterキーを押す、**Then** 次のステップに進む
3. **Given** チュートリアルが表示されている、**When** Escapeキーを押す、**Then** チュートリアルが終了する
4. **Given** スクリーンリーダーを使用中、**When** チュートリアルが開始される、**Then** ポップアップのタイトル、説明文、ボタンの役割が正しく読み上げられる
5. **Given** チュートリアルのポップアップが表示されている、**When** スクリーンリーダーがページを読む、**Then** `role="dialog"`、`aria-labelledby`、`aria-describedby`などの適切なARIA属性が設定されている

---

### Edge Cases

- **ウィンドウリサイズ中**: チュートリアル表示中にブラウザウィンドウをリサイズした場合、ハイライトとポップアップの位置がリアルタイムで再計算され、正しい位置に表示される
- **対象要素が存在しない**: チュートリアルのステップで参照する要素（例: フィードURL入力欄）がDOM上に存在しない場合、そのステップをスキップするか、エラーログを出力し、チュートリアルを正常に続行する
- **localStorageが無効**: ブラウザでlocalStorageが無効化されている場合、チュートリアルは毎回表示される（エラーは発生させず、フォールバック動作）
- **ページ遷移中**: チュートリアル表示中にユーザーがブラウザの戻る/進むボタンを押した場合、チュートリアルは自動的に終了し、履歴管理に干渉しない
- **複数タブ**: 同じブラウザで複数のタブでアプリを開いた場合、1つのタブでチュートリアルを完了すると、他のタブでも自動表示されなくなる（localStorage共有）
- **スクロール必要な要素**: ハイライトする要素が画面外にある場合、自動的にその要素までスクロールし、画面中央に表示する
- **長時間放置**: チュートリアル途中で数分放置された場合でも、セッションタイムアウトは発生せず、ユーザーが戻ってきたら続きから操作できる

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは初回訪問時（購読フィードが0件の状態）に自動的にチュートリアルを開始しなければならない
- **FR-002**: システムはチュートリアルの表示状態（完了/未完了）をlocalStorageに永続化しなければならない
- **FR-003**: システムはアプリヘッダーに「ヘルプ」ボタンを表示し、クリック時にチュートリアルを再開できなければならない
- **FR-004**: チュートリアルは以下の7つのステップを順序通りに表示しなければならない:
  1. フィードURL入力欄のハイライトと説明
  2. フィード追加ボタンのハイライトと説明
  3. 購読リストエリアのハイライトと説明
  4. インポート/エクスポートボタンのハイライトと説明
  5. 検索バーのハイライトと説明
  6. ポーリング状態表示エリアのハイライトと説明
  7. 記事カードのハイライトと説明
- **FR-005**: 各ステップは対応する画面要素をハイライト表示し、その要素の近くにポップアップで説明を表示しなければならない
- **FR-006**: ポップアップには「次へ」ボタンと「スキップ」ボタンを含み、ユーザーが操作を制御できなければならない
- **FR-007**: ユーザーは「スキップ」ボタンまたはEscapeキーでいつでもチュートリアルを終了できなければならない
- **FR-008**: チュートリアルはレスポンシブデザインで、デスクトップ（1024px以上）、タブレット（768px-1023px）、モバイル（767px以下）すべてのデバイスで適切に表示されなければならない
- **FR-009**: チュートリアルのポップアップとハイライトは、画面リサイズ時にリアルタイムで位置を再計算しなければならない
- **FR-010**: チュートリアルは以下のARIA属性を設定し、アクセシビリティを確保しなければならない:
  - ポップアップ: `role="dialog"`, `aria-labelledby`, `aria-describedby`
  - ハイライトエリア: `aria-label="チュートリアルのハイライト領域"`
  - ステップナビゲーション: `aria-live="polite"`, `aria-current="step"`
- **FR-011**: チュートリアルは以下のキーボード操作をサポートしなければならない:
  - Enter: 次のステップへ進む
  - Escape: チュートリアル終了
  - Tab: フォーカス移動（「次へ」→「スキップ」）
- **FR-012**: ハイライトする要素が画面外にある場合、システムは自動的にその要素までスクロールし、画面中央に表示しなければならない
- **FR-013**: localStorageが無効化されている場合、システムはエラーを発生させず、毎回チュートリアルを表示するフォールバック動作を行わなければならない
- **FR-014**: チュートリアルのポップアップは、対応する要素の位置に応じて自動的に最適な位置（上下左右）に配置されなければならない
- **FR-015**: チュートリアルはページ読み込み完了後、すべてのDOM要素がレンダリングされた後に開始しなければならない

### Key Entities

- **TutorialState**: チュートリアルの状態を管理するエンティティ
  - 属性: `hasSeenTutorial`（boolean: チュートリアル完了フラグ）
  - 属性: `currentStep`（number: 現在のステップ番号、0-6）
  - 属性: `isActive`（boolean: チュートリアルが現在表示されているか）
  - ストレージ: localStorage（キー: `rss_reader_tutorial_seen`）

- **TutorialStep**: 各チュートリアルステップの定義
  - 属性: `element`（string: CSSセレクター、ハイライトする要素）
  - 属性: `title`（string: ステップのタイトル）
  - 属性: `description`（string: ステップの説明文）
  - 属性: `position`（'top' | 'bottom' | 'left' | 'right': ポップアップの表示位置）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 新規ユーザーの90%以上が、初回訪問時にチュートリアルを最初のステップまで表示できる（自動表示の成功率）
- **SC-002**: チュートリアルを開始したユーザーの70%以上が、最後のステップまで完了またはスキップボタンで意図的に終了できる（完了率）
- **SC-003**: チュートリアル完了後、ユーザーがフィードを追加する成功率が50%以上向上する（行動変容の測定）
- **SC-004**: ヘルプボタンから再度チュートリアルを開始したユーザーの95%以上が、エラーなく全ステップを閲覧できる（再利用性）
- **SC-005**: 異なる画面サイズ（320px、768px、1024px、1920px）すべてで、チュートリアルのポップアップが画面内に収まり、テキストが読める（レスポンシブ対応の成功率100%）
- **SC-006**: キーボードのみで操作するユーザーが、マウスなしで全ステップを完了できる（アクセシビリティ対応100%）
- **SC-007**: スクリーンリーダー（NVDA、JAWS）で各ステップの説明が正しく読み上げられる（アクセシビリティ監査の合格）
- **SC-008**: チュートリアル表示から次のステップへの遷移が500ms以内に完了する（レスポンスタイム）
- **SC-009**: チュートリアル機能追加後も、アプリ全体の初回読み込み時間が200ms以内の増加に抑えられる（パフォーマンス影響）
- **SC-010**: ユーザーサポート問い合わせのうち、「使い方がわからない」関連の問い合わせが30%以上減少する（ビジネスメトリクス）

## Assumptions *(mandatory)*

- アプリは既にReact 19とTailwindCSSで構築されており、これらの技術スタックは変更しない
- driver.jsライブラリはReact 19と互換性があり、本番環境で安定動作する
- ユーザーのブラウザはモダンブラウザ（Chrome、Firefox、Safari、Edge最新版）で、localStorageがサポートされている
- 初回訪問の判定は「購読フィードが0件」を条件とする（厳密な初回訪問検出ではない）
- チュートリアルの7ステップは固定で、動的な追加・削除は行わない
- チュートリアルの説明文は日本語のみで、多言語対応は将来の拡張として扱う
- チュートリアル中にアプリの他の機能（フィード追加、記事閲覧など）は操作できない（モーダル動作）
- チュートリアルのポップアップはダークモード対応は初期バージョンでは不要（TailwindCSSのライトモードのみ）

## Out of Scope *(mandatory)*

- チュートリアル内容の動的変更機能（管理画面からの編集など）
- チュートリアルの進捗保存（途中で中断して後から再開する機能）
- 複数の異なるチュートリアル（初級、上級など）の提供
- チュートリアル完了率などの分析・トラッキング機能（Googleアナリティクスとの連携）
- ビデオチュートリアルやアニメーションGIFの埋め込み
- チュートリアルのA/Bテスト機能
- 多言語対応（英語、中国語など）
- ダークモード対応
- チュートリアルのカスタマイズ（ユーザーが表示するステップを選択）
- 音声ガイダンスや音声読み上げ機能
- チュートリアルのエクスポート・インポート機能
- 管理者向けのチュートリアル管理ダッシュボード
