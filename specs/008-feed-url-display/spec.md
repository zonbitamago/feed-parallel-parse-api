# Feature Specification: 購読フィード識別表示の改善

**Feature Branch**: `008-feed-url-display`
**Created**: 2025-10-29
**Status**: Draft
**Input**: User description: "登録しているRSSフィードのURLがどのサイトのものかわかりやすくしたい"

## 明確化 *(Clarifications)*

### セッション 2025-10-29

- Q: フィードを識別しやすくするために、どのような情報を表示すべきか？ → A: フィードタイトル自動取得 + 手動編集も可能（基本はフィードから自動取得するが、分かりにくい場合はユーザーが編集できる）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - フィードタイトルの自動取得と表示 (Priority: P1)

ユーザーは、購読リストを見たときに、URLではなく分かりやすいフィードタイトルで各フィードを識別したいと考えています。現在はURLのみが表示されており、どのサイトのフィードか判断するのに時間がかかります。

**Why this priority**: これが本機能の中核となる価値です。ユーザーが複数のフィードを管理する際に、タイトル表示は必須の機能です。

**Independent Test**: 複数のRSSフィードを購読し、それぞれのフィードタイトルが購読リストに表示されることで完全にテストできます。

**Acceptance Scenarios**:

1. **Given** ユーザーが新しいRSSフィードURLを追加する、**When** フィードの取得が成功する、**Then** そのフィードのタイトル（例：「はてなブックマーク - 人気エントリー」）が購読リストに表示される
2. **Given** RSSフィードにタイトル情報が含まれている、**When** フィードを取得する、**Then** フィードXMLの`<title>`要素から自動的にタイトルが抽出される
3. **Given** ユーザーが購読リストを表示している、**When** フィードにタイトルがある、**Then** タイトルが主表示、URLが副表示（小さいフォント）として階層的に表示される
4. **Given** フィードの取得に失敗した、**When** タイトルが取得できない、**Then** URLが代替として表示される

---

### User Story 2 - フィード表示名の手動編集 (Priority: P2)

ユーザーは、自動取得されたフィードタイトルが分かりにくい場合や、自分の好みの名前に変更したい場合に、表示名を編集できることを期待しています。

**Why this priority**: 自動取得が基本機能ですが、ユーザーが自分でカスタマイズできることで使いやすさが大幅に向上します。ただし、自動取得機能があれば最低限の価値は提供できます。

**Independent Test**: フィードの表示名を編集し、その変更が保存され、次回アクセス時も編集した名前が表示されることで完全にテストできます。

**Acceptance Scenarios**:

1. **Given** ユーザーが購読リストのフィードを表示している、**When** フィード名の編集ボタンをクリックする、**Then** 編集可能な入力フィールドが表示される
2. **Given** ユーザーがフィード名を編集している、**When** 新しい名前を入力して保存する、**Then** 購読リストに新しい名前が表示される
3. **Given** ユーザーがカスタム名を設定した、**When** ページをリロードする、**Then** カスタム名が保持されて表示される
4. **Given** ユーザーがフィード名を編集している、**When** キャンセルする、**Then** 元の名前（自動取得されたタイトルまたは前回保存した名前）に戻る

---

### User Story 3 - フィード追加時のタイトルプレビュー (Priority: P3)

ユーザーは、新しいフィードを追加する際に、取得されるフィードタイトルを事前にプレビューで確認できることを期待しています。これにより、正しいフィードを追加しているという安心感が得られます。

**Why this priority**: ユーザー体験を向上させる付加機能ですが、追加後にもタイトルは確認できるため、MVPには必須ではありません。

**Independent Test**: フィード追加フォームにURLを入力し、フィードを追加する前にタイトルのプレビューが表示されることで完全にテストできます。

**Acceptance Scenarios**:

1. **Given** ユーザーがフィード追加フォームに有効なRSSフィードURLを入力した、**When** URLの入力を完了する、**Then** 「このフィードのタイトル: [タイトル名]」のようなプレビューが表示される
2. **Given** ユーザーがURLを入力中である、**When** まだURLが完全でない、**Then** プレビューは表示されない
3. **Given** フィードの取得に失敗した、**When** プレビューを表示しようとする、**Then** 「タイトルを取得できませんでした」のようなメッセージが表示される

---

### Edge Cases

- RSSフィードにタイトル要素が存在しない場合はどうなるか？（URLを代替として表示し、ユーザーに手動で名前を設定するよう促す）
- フィードタイトルが空文字列の場合はどうなるか？（URLを代替として表示）
- フィードタイトルが非常に長い場合はどうなるか？（100文字を超える場合は省略記号で切り詰め、ホバーまたはクリックで全体を表示）
- ユーザーが編集したカスタム名が空の場合はどうなるか？（保存を拒否し、エラーメッセージを表示：「フィード名を入力してください」）
- 複数のフィードが同じタイトルを持つ場合はどうなるか？（タイトルはそのまま表示、URLで区別可能）
- HTMLタグやエンティティがタイトルに含まれる場合はどうなるか？（HTMLをエスケープまたは削除して表示）
- フィードのタイトルが更新された場合はどうなるか？（ユーザーがカスタム名を設定していない場合は自動更新、カスタム名を設定している場合はカスタム名を保持）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、RSSフィードの追加時にフィードのタイトル情報を自動的に取得しなければならない
- **FR-002**: システムは、フィードのタイトルが取得できない場合、URLを代替として表示しなければならない
- **FR-003**: システムは、購読リストで各フィードをタイトルで表示し、その下にURLを小さく表示しなければならない
- **FR-004**: ユーザーは、購読リストから各フィードの表示名を編集できなければならない
- **FR-005**: システムは、ユーザーが編集したカスタム表示名を永続的に保存しなければならない
- **FR-006**: システムは、ユーザーがカスタム名を設定していない場合、フィード更新時に自動取得されたタイトルを更新しなければならない
- **FR-007**: システムは、ユーザーがカスタム名を設定している場合、そのカスタム名を保持しなければならない（自動更新しない）
- **FR-008**: システムは、フィードタイトルに含まれるHTMLタグやエンティティを適切にエスケープまたは削除して表示しなければならない

### Key Entities

- **フィード購読情報**: 各購読フィードの表示に関する情報
  - 主要属性：フィードURL、自動取得タイトル、カスタム表示名（オプション）、カスタム名設定フラグ
  - 関係：1つの購読に対して1つの表示情報が紐づく
  - 表示ロジック：カスタム名が設定されている場合はカスタム名を表示、未設定の場合は自動取得タイトルを表示、タイトルがない場合はURLを表示

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーが購読リストを見たときに、2秒以内に各フィードが何のフィードか識別できる
- **SC-002**: フィードの95%以上で、URLではなく分かりやすいタイトルが表示される
- **SC-003**: ユーザーがフィード名を編集する操作が、3ステップ以内（クリック→入力→保存）で完了する
- **SC-004**: フィード管理に関するユーザーの混乱や問い合わせが70%削減される

## Assumptions

- ほとんどのRSSフィードには`<title>`要素が含まれている
- ユーザーは、URLよりもフィードタイトルでフィードを識別する方が容易である
- フィードタイトルの自動取得は、既存のフィード取得処理の一部として実装可能である
- ユーザーがカスタム名を設定するケースは全体の20%程度である
- 既存のlocalStorageストレージシステムでカスタム名の保存が可能である

## Dependencies

- 既存の購読管理機能（001-rss-reader）が正常に動作していること
- RSSフィード解析機能がフィードのタイトル情報を抽出できること
- localStorageを使用したデータ永続化機能が利用可能であること

## Out of Scope

- フィード提供元のファビコン（サイトアイコン）の表示
- フィードのカテゴリやタグ付け機能
- フィードタイトルでのグループ化やソート機能
- フィードタイトルの翻訳や言語対応
- 複数フィードの一括名前変更機能
